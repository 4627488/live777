<button onclick="window.startWebrtc()"> WebRTC Start </button>
<br />
Video<br />
<div id="remoteVideos"></div> <br />

Logs<br />
<div id="div"></div>

<script>
let log = msg => {
  document.getElementById('div').innerHTML += msg + '<br>'
}

window.startWebrtc = async () => {
		let pc = new RTCPeerConnection({
			iceServers: [
				{
					urls: 'stun:stun.l.google.com:19302'
				}
			]
		})

		pc.ontrack = function (event) {
			var el = document.createElement(event.track.kind)
			el.srcObject = event.streams[0]
			el.autoplay = true
			el.controls = true

			document.getElementById('remoteVideos').appendChild(el)
		}

		pc.oniceconnectionstatechange = e => log(pc.iceConnectionState)
		pc.onicecandidate = event => {
			if (event.candidate === null) {
				console.log(pc.localDescription)
			}
		}

		// Offer to receive 1 audio, and 2 video tracks
		//pc.addTransceiver('audio', {'direction': 'recvonly'})
		pc.addTransceiver('video', {'direction': 'recvonly'})
		//pc.addTransceiver('video', {'direction': 'recvonly'})
		const offer = await pc.createOffer()
		await pc.setLocalDescription(offer)

		const res = await reqSdp(offer)
		sdp_data = await res.text()
		const data = new RTCSessionDescription(
			{
				type:"answer",
				sdp:sdp_data
			}
		)
		pc.setRemoteDescription(await data)

	}

	async function reqSdp(offer) {
		return fetch('/whep/endpoint', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/sdp'
			},
			body: offer.sdp,
		})
	}

</script>
