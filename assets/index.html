<input id="resource" type="text">
<button onclick="window.startWebrtc(true)"> WebRTC Start Whip</button>
<button onclick="window.startWebrtc(false)"> WebRTC Start Whep</button>

<br/>
Video<br/>
<div id="remoteVideos"></div> <br/>

Logs<br/>
<div id="div"></div>

<script>
    let log = msg => {
        document.getElementById('div').innerHTML += msg + '<br>'
    }

    window.startWebrtc = async (whip) => {
        const resource = document.getElementById("resource").value;
        if (!resource) {
            alert("input resource")
            return
        }
        let pc = new RTCPeerConnection({
            iceServers: [
                {
                    urls: 'stun:stun.l.google.com:19302'
                }
            ]
        })
        let uri = "/whip/" + resource
        if (!whip) {
            uri = "/whep/endpoint/" + resource;
        }
        if (whip) {
            const screenStream = await navigator.mediaDevices.getDisplayMedia({video: true});
            screenStream.getTracks().forEach(track => {
                track.id = "c1861bb6-f6fc-46ad-965a-e53f24403212";
                pc.addTrack(track, screenStream);
            });
        } else {
            pc.addTransceiver('video', {'direction': 'recvonly'})
            pc.ontrack = function (event) {
                var el = document.createElement(event.track.kind)
                el.srcObject = event.streams[0]
                el.autoplay = true
                el.controls = true
                document.getElementById('remoteVideos').appendChild(el)
            }
        }
        pc.oniceconnectionstatechange = e => log(pc.iceConnectionState)
        pc.onicecandidate = event => {
            if (event.candidate === null) {
                console.log(pc.localDescription)
            }
        }
        const offer = await pc.createOffer()
        await pc.setLocalDescription(offer)
        const res = await reqSdp(offer, uri)
        body = await res.text()
        if (res.status !== 201) {
            alert(body)
            pc.close()
            return
        }
        const data = new RTCSessionDescription(
            {
                type: "answer",
                sdp: body
            }
        )
        pc.setRemoteDescription(await data)
    }

    async function reqSdp(offer, uri) {
        return fetch(uri, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/sdp'
            },
            body: offer.sdp,
        })
    }

</script>